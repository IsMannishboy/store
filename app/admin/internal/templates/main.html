<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | MyShop</title>
    <meta id="csrf" content="{{.csrf}}">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f3f4f6;
            display: flex;
        }
        .sidebar {
            width: 220px;
            background: #1f2937;
            color: white;
            height: 100vh;
            padding: 20px;
        }
        .sidebar h2 {
            margin-top: 0;
            text-align: center;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
        }
        .sidebar li {
            margin: 15px 0;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
        }
        .content {
            flex: 1;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f9fafb;
        }
        .btn {
            background: #2563eb;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn:hover {
            background: #1d4ed8;
        }
        #add-form {
            display: none;
            margin-top: 15px;
        }
        input, select {
            padding: 6px;
            margin: 4px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>MyShop</h2>
        <ul>
            <li><a href="#">üì¶ –¢–æ–≤–∞—Ä—ã</a></li>
            <li><a href="#">üõí –ó–∞–∫–∞–∑—ã</a></li>
            <li><a href="#">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
            <li><a href="#">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
        </ul>
    </div>

    <div class="content">
        <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <div class="card">
            <h3>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="product-table">
                    {{if .products}}
                    {{range .products}}
                    <tr data-id="{{.Id}}">
                        <td>{{.Id}}</td>
                        <td>{{.Name}}</td>
                        <td>{{.Price}}</td>
                        {{if .Stock}}
                            <td>–≤ –Ω–∞–ª–∏—á–∏–∏: {{.Stock}}</td>
                        {{else}}
                            <td>–Ω–µ –≤ –Ω–∞–ª–∏—á–∏–∏</td>
                        {{end}}
                        <td>{{.Description}}</td>
                        <td>{{.Category}}</td>
                        <td>
                            <button class="btn delete-btn">üóë –£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    </tr>
                    {{end}}
                    {{end}}
                </tbody>
            </table>

            <br>
            <button class="btn" id="show-add-form">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

            <form id="add-form">
                <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                <input type="number" id="price" placeholder="–¶–µ–Ω–∞" required>
                <input type="number" id="stock" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
                <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                <input type="text" id="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
                <button type="submit" class="btn">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
        </div>
        <div>
            <p>users list</p><br>
            <ul>
                {{if .users}}
                {{range .users}}
                <li>
                    <div>
                        <p>name:{{.Username}}</p>
                        <p>email:{{.Email}}</p>
                        <button class="user delete">delete</button>
                    </div>
                </li>
                {{end}}
                {{else}}
                <li>empty list</li>
                {{end}}
            </ul>
        </div>
    </div>

    <script>
document.addEventListener("DOMContentLoaded", () => {
    const table = document.getElementById("product-table");
    const csrf = document.getElementById("csrf").content;

    // === –£–î–ê–õ–ï–ù–ò–ï ===
    table.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-btn")) {
            const row = e.target.closest("tr");
            const id = row.dataset.id;

            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) return;

            const res = await fetch(`/delete/${id}/${csrf}`, { method: "POST" });
            if (res.ok) row.remove();
            else alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏");
        }
    });

    // === –î–û–ë–ê–í–õ–ï–ù–ò–ï ===
    document.getElementById("show-add-form").addEventListener("click", () => {
        const form = document.getElementById("add-form");
        form.style.display = form.style.display === "none" ? "block" : "none";
    });

    document.getElementById("add-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const price = parseFloat(document.getElementById("price").value);
        const stock = parseInt(document.getElementById("stock").value);
        const desc = document.getElementById("desc").value;
        const category = document.getElementById("category").value;

        const body = { name, price, stock, desc, category };

        const res = await fetch(`/add/${csrf}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        if (res.ok) {

            // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            const row = document.createElement("tr");
            row.dataset.id = body.Id;
            row.innerHTML = `
                <td>${body.Id}</td>
                <td>${body.Name}</td>
                <td>${body.Price}</td>
                <td>–≤ –Ω–∞–ª–∏—á–∏–∏: ${body.Stock}</td>
                <td>${body.Description}</td>
                <td>${body.Category}</td>
                <td><button class="btn delete-btn">üóë –£–¥–∞–ª–∏—Ç—å</button></td>
            `;
            table.appendChild(row);

            e.target.reset();
            e.target.style.display = "none";
        } else {
            
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞");
        }
    });
});
</script>

